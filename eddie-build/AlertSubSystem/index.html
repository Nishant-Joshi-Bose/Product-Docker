<!DOCTYPE html>
<html>
<head>
<style>
body {font-family: "Lato", sans-serif;}

/* Style the tab */
div.tab {
    overflow: hidden;
    border: 1px solid #ccc;
    background-color: #f1f1f1;
}

/* Style the buttons inside the tab */
div.tab button {
    background-color: inherit;
    float: left;
    border: none;
    outline: none;
    cursor: pointer;
    padding: 14px 16px;
    transition: 0.3s;
    font-size: 17px;
}

/* Change background color of buttons on hover */
div.tab button:hover {
    background-color: #ddd;
}

/* Create an active/current tablink class */
div.tab button.active {
    background-color: #ccc;
}

/* Style the tab content */
.tabcontent {
    display: none;
    padding: 6px 12px;
    border: 1px solid #ccc;
    border-top: none;
}

#messages {
      border: 2px solid #fec; border-radius: 1em;
      height: 10em; overflow: scroll; padding: 0.5em 1em;
    }
</style>
<script language="javascript" type="text/javascript">

//var ws = new WebSocket('ws://' + '127.0.0.1:8000' );
var ws = new WebSocket('ws://' + location.host );

  ws.onopen = function(ev)  { console.log(ev); };
  ws.onerror = function(ev) {
    console.log(ev);
  };

  ws.onclose = function(ev) { console.log(ev); };
  ws.onmessage = function(ev) {
    console.log(ev);
    var div = document.createElement('div');
    div.innerHTML = ev.data;
    var div_msg = document.getElementById('messages');
    div_msg.appendChild(div);

    div_msg.scrollTop = div_msg.scrollHeight;
  };


if (!window.console) { window.console = { log: function() {} } };

window.onload = function () {

var hour =["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23"];
    var min =["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59"];
    var selhr = document.getElementById('hour');
    var selmin = document.getElementById('min');

    for (var i = 0; i < hour.length;i++)
    {
      var opt = document.createElement('option');
      opt.innerHTML = hour[i];
      opt.value = hour[i];
      selhr.appendChild(opt);
    }

    for (var i = 0; i < min.length;i++)
    {
      var opt = document.createElement('option');
      opt.innerHTML = min[i];
      opt.value = min[i];
      selmin.appendChild(opt);
    }
}
function openCity(evt, cityName) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(cityName).style.display = "block";
    evt.currentTarget.className += " active";
}
/*
function set_alarm() {
  var hr = document.getElementById('hour');
  var min = document.getElementById ('min');
  <!--var msg = "ALARM" + "," + hr.value + ":" + min.value;--> 
  var sch = hr.value + ":" + min.value;
  var msg = {"alert_type":"ALARM","scheduled_time":sch};
  ws.send(msg);
}
*/
function set_alarm() {
  var hr = document.getElementById('hour');
  var min = document.getElementById ('min');
  //var sch = hr.value + ":" + min.value;
  //var msg = {"alert_type":"ALARM","scheduled_time":sch};
  var now = new Date ();
  now.setHours(parseInt(hr.value));
  now.setMinutes (parseInt(min.value));
  now.setSeconds (0);
  var obj = new Object();
  obj.alert_type = "ALARM";
  //var tz = now_utc.getTimezoneOffset ();
  var tz = now.getTimezoneOffset ();
  //var utc_str = now_utc.toISOString();
  var utc_str = now.toISOString();
  utc_str = utc_str.slice (0,utc_str.indexOf("."));
  if (tz > 0)
    utc_str = utc_str + "-";
  else
    utc_str = utc_str + "+";
  var tz_hr = tz / 60;
  utc_str = tz_hr > 9 ? utc_str +tz_hr.toString() : utc_str + "0"+tz_hr.toString();
  var tz_min = tz % 60;
  utc_str = tz_min > 9 ? utc_str +tz_min.toString() : utc_str + "0"+tz_min.toString();
  obj.schedule_time = utc_str;
  var msg = JSON.stringify (obj);

  ws.send(msg);
}
function delete_alert () {
<!-- PJ - <TBD> logic to add support for delete alert -->
  var id = document.getElementById('alert_id');
  var obj = new Object ();
  obj.alert_type = "DELETE";
  obj.alert_id = id.value;
  var msg = JSON.stringify (obj); 
  ws.send(msg);
  id.value = "";
}
function set_timer () {
  var tmr = document.getElementById('set_timer_input');
  var now = new Date ();
  var now_utc = new Date(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(),  now.getUTCHours(), now.getUTCMinutes(), now.getUTCSeconds());
  //now_utc.setTime ( now_utc.getTime () + (parseInt(tmr.value)*1000));
  now.setTime ( now.getTime () + (parseInt(tmr.value)*1000));
  var obj = new Object();
  obj.alert_type = "TIMER";
  //var tz = now_utc.getTimezoneOffset ();
  var tz = now.getTimezoneOffset ();
  //var utc_str = now_utc.toISOString();
  var utc_str = now.toISOString();
  utc_str = utc_str.slice (0,utc_str.indexOf("."));
  if (tz > 0)
    utc_str = utc_str + "-";
  else
    utc_str = utc_str + "+";
  var tz_hr = tz / 60;
  utc_str = tz_hr > 9 ? utc_str +tz_hr.toString() : utc_str + "0"+tz_hr.toString(); 
  var tz_min = tz % 60;
  utc_str = tz_min > 9 ? utc_str +tz_min.toString() : utc_str + "0"+tz_min.toString(); 
  obj.schedule_time = utc_str;
  var msg = JSON.stringify (obj); 
  ws.send(msg)
  obj = undefined;
}
</script>
</head>
<body>

<p>Alert Subsystem Demo</p>

<div class="tab">
  <button class="tablinks" onclick="openCity(event, 'Timer')">Timer</button>
  <button class="tablinks" onclick="openCity(event, 'Alarm')">Alarm</button>
</div>

<div id="Alarm" class="tabcontent">
  <b>hr:min</b><br>
  <select id="hour" size=2 multiple>
    <option>0</option>
  </select>
  <select id="min" size=2 multiple>
    <option>0</option>
  </select>
  <button id='set_alarm' onclick="set_alarm()">Set Alarm</button>
</div>

<div id="Timer" class="tabcontent">
  <b>Set timer in seconds </b> <br>
  <input id='set_timer_input'>
  <button id='set_timer' onclick="set_timer()">Set Timer</button>
</div>

    <br>
    <div id="messages">
    </div>

    <br>
    <div id='delete_alert'>
      <b>Delete scheduled or active alert </b> <br>
      <input id='alert_id'>
      <button id='delete_alert' onclick="delete_alert()">Delete Alert</button>
 
    </div>
     
</body>
</html> 

