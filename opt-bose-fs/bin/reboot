#!/bin/bash
#
# Reboot the product.
#
# PlatformReset requires LPMService to be running.  If PlatformReset fails,
# try ResetUtil which talks directly to the LPM.  If ResetUtil fails, try
# /sbin/reboot which will affect only the APQ.
#

function warn {
    logger -s -t "product/reboot[$$]" -p warning "$*"
}

warn PlatformReset...
if ! { killall -0 LPMService && PlatformReset; }; then
    warn Fallback to ResetUtil...
    ResetUtil SYSTEM
fi
sleep 20
warn Fallback to /sbin/reboot...
/sbin/reboot
