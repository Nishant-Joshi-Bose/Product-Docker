#!/bin/sh
#
# Write a dprint.conf file.
#
# See: setlog --help
#
#
this=${0##*/} # this script's name

PATH=/usr/local/bin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin:/sbin
conf=/mnt/nv/dprint.conf
gen="$0 $*"

tryhelp () {
    echo >&2 "Try '$this --help' for more information."
    exit 1
}
opts=$(getopt --name "$this" --shell sh \
    -o c:h \
    -l "conf:,
        help" \
    -- "$@") || tryhelp
eval set -- "$opts"
while :; do
    arg="$1"; shift
    case "$arg" in
        (--conf | -c) conf=$1; shift ;;
        (--help | -h)
            cat <<EOF
usage: $this LEVEL

LEVEL is one of:
0-7 critical error warning info debug test_automation verbose insane off

--conf (-c) FILE   Which file to write (default: $conf)
EOF
            exit 0
            ;;

        (--) break ;;
        (*)  echo >&2 "$this: internal error at '$arg'"; exit 1 ;;
    esac
done

if [ $# -ne 1 ]; then
    echo >&2 "$this: wrong number of arguments"
    tryhelp
fi
level=$1; shift

case "$level" in
    ([0-7] | critical | error | warning | info | debug | \
     test_automation | verbose | insane | off )
        :
        ;;
    (*)
        echo >&2 "$this: invalid log level '$level'"
        tryhelp
        ;;
esac

cat >"$conf" <<EOF || exit 1
# Generated by: $gen
all $level
EOF

echo "Wrote $conf"
exit 0
