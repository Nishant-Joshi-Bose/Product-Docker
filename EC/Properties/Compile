# -*- sh -*-
# This is an Electric Commander script which is mostly like Shell but allows
# certain non-Shell constructs like $[buildDir].

set -x

cd $[buildDir]
CastleToolsDir=/home/epd/srcref/CastleTools
export PATH=$CastleToolsDir/bin:/tools/klocwork/user/bin:/tools/klocwork/server/bin:$PATH

if [ "$[/javascript myJob.Klocwork]" = "true" ]; then
    KWINJECT="kwinject -I 'testCCompiler.c,testCXXCompiler.cxx' --ignore-files */proto/*"
fi

export DONT_UPDATE_CASTLETOOLS=1
export GENERATE_HSP_SIGNATURES=1
eval $KWINJECT make jobs=8 hw_var=Alpha deploy || exit

if [ "$[BuildType]" = "Release" ]; then
    git clone git@github.com:BoseCorp/iot-profile-creator
    for env in alpha latest integration stage; do
        python2.7 iot-profile-creator/update_product_profile.py --p professor       --v $[Version] --e $env --s $(ectool getFullCredential IoT-Profile-Password --value password)
        python2.7 iot-profile-creator/update_product_profile.py --p ginger-cheevers --v $[Version] --e $env --s $(ectool getFullCredential IoT-Profile-Password --value password)
    done
fi

: success
